#!/usr/bin/env ruby

require "optparse"
require "rubygems"
require "json"

# set up loadpath
here = File.dirname(__FILE__)
SPAWN_CONTROL_ROOT = File.expand_path("#{here}/..")
$LOAD_PATH.unshift("#{SPAWN_CONTROL_ROOT}/lib")

require "spawn_control"

options = {
  :configuration => "spawn_control.json"
}

# TODO: config file flag
OptionParser.new do |parser|
  parser.on("-c", "--configuration=FILE", "The origin of the events") do |file|
    options[:configuration] = file
  end
end.parse!


string = File.read(options[:configuration])
configuration = JSON.parse(string, :symbolize_names => true)
spawner = SpawnControl.new(configuration)

trap("INT") do
  exit
end

require "spawn_control/console"
spawner.start
spawner.console


